package org.netcomputing.webservices.database;

import java.net.UnknownHostException;

import org.netcomputing.webservices.datamodel.User;
import org.netcomputing.webservices.server.ConfigLoader;

import com.mongodb.BasicDBObject;
import com.mongodb.DB;
import com.mongodb.DBCollection;
import com.mongodb.MongoClient;

/**
 * 
 * @author Jose and Stijn
 * @version 0.1
 */
public enum UserRepository {
	
	/**
	 * The (unique) instance of MongoDB
	 */
	instance;
	     
	/**
	 * The abstraction of a (concrete) database
	 */
	private static DB db ;
	
	/**
	 * The mongoClient that connects to a database instance
	 * @see https://docs.mongodb.org/getting-started/java/client/
	 */
	private static MongoClient mongoClient;

	/**
	 * The variable that abstracts the loading of the configuration file
	 */
	private ConfigLoader configLoader;
	
	private String collectionName = "users";
	
	private DBCollection usersCollection;
	
	private UserRepository() {};

	/**
	 * Initializes the singleton object
	 * @param configLoader holds the preloaded settings from an external file
	 */
	public void InitializeUserRepository(ConfigLoader configLoader) {
		this.configLoader = configLoader;
		DB database = mongoClient.getDB(this.configLoader.getDbName()); // if the DB doesn't exist, Mongo will create it
		usersCollection = database.getCollection(collectionName);
	}
	 
	public void createUser(User u) {
		if (usersCollection != null) {
			BasicDBObject document = new BasicDBObject();
			//document.put("uid", u.getUID());
			document.put("name",  u.getName());
			document.put("score",  u.getScore());
			document.put("translation", u.getTranslations());
		}
	}
	
	
	// to check later
	public DB getDB() {
		if (mongoClient == null) {
			try {
				mongoClient = new MongoClient(configLoader.getDbAddress(), configLoader.getDbPort());
			} catch (UnknownHostException e) {
				System.out.println("Error. Impossible to create MongoClient; track: " + e);
			return null;
			}
		}
		if (db == null) {
			db = mongoClient.getDB(configLoader.getDbName());
		}
		return db;
	}

}
